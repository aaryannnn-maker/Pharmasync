<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ medicine.name }} - PharmaSync</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
</head>
<body class="bg-background min-h-screen">
    {% include 'header.html' %}

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-6 py-6 space-y-6">
        <!-- Breadcrumb -->
        <nav class="flex items-center gap-2 text-sm text-text-tertiary">
            <a href="{{ url_for('dashboard') }}" class="hover:text-primary">Dashboard</a>
            <span>›</span>
            <a href="{{ url_for('inventory') }}" class="hover:text-primary">Inventory</a>
            <span>›</span>
            <span class="text-text-primary font-medium">{{ medicine.name }}</span>
        </nav>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="{% if category == 'error' %}bg-error-50 border-error-200 text-error-700{% else %}bg-success-50 border-success-200 text-success-700{% endif %} border rounded-lg p-4">
                        <p class="text-sm font-medium">{{ message }}</p>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <!-- Medicine Header -->
        <div class="card">
            <div class="flex flex-col md:flex-row md:items-start md:justify-between gap-6">
                <div class="flex-1">
                    <h1 class="text-3xl font-heading font-bold text-text-primary mb-2">{{ medicine.name }}</h1>
                    <p class="text-text-secondary mb-4">{{ medicine.generic_name or 'No generic name' }}</p>
                    
                    <div class="flex flex-wrap gap-2 mb-6">
                        <span class="badge badge-success">{{ medicine.category }}</span>
                        {% if medicine.quantity <= medicine.reorder_level %}
                        <span class="badge badge-warning">Low Stock</span>
                        {% endif %}
                        {% if medicine.expiry_date and medicine.expiry_date < now.date() %}
                        <span class="badge badge-error">Expired</span>
                        {% elif medicine.expiry_date and (medicine.expiry_date - now.date()).days < 30 %}
                        <span class="badge badge-warning">Expiring Soon</span>
                        {% endif %}
                    </div>
                </div>
                
                <div class="flex gap-3">
                    <a href="{{ url_for('edit_medicine', id=medicine.id) }}" class="btn btn-accent">
                        Edit Medicine
                    </a>
                    <form method="POST" action="{{ url_for('delete_medicine', id=medicine.id) }}" onsubmit="return confirm('Are you sure you want to delete this medicine?');">
                        <button type="submit" class="btn bg-error text-white hover:bg-error-600">
                            Delete
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Details Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Stock Information -->
            <div class="card">
                <h3 class="text-xl font-heading font-semibold text-text-primary mb-6">Stock Information</h3>
                <div class="space-y-4">
                    <div>
                        <p class="text-sm text-text-tertiary mb-1">Current Stock</p>
                        <p class="text-3xl font-heading font-bold {% if medicine.quantity <= medicine.reorder_level %}text-warning{% else %}text-success{% endif %}">
                            {{ medicine.quantity }} units
                        </p>
                    </div>
                    <div>
                        <p class="text-sm text-text-tertiary mb-1">Reorder Level</p>
                        <p class="text-lg font-medium text-text-primary">{{ medicine.reorder_level }} units</p>
                    </div>
                    <div>
                        <p class="text-sm text-text-tertiary mb-1">Location</p>
                        <p class="text-lg font-medium text-text-primary">{{ medicine.location or 'Not specified' }}</p>
                    </div>
                </div>
            </div>

            <!-- Product Details -->
            <div class="card">
                <h3 class="text-xl font-heading font-semibold text-text-primary mb-6">Product Details</h3>
                <div class="space-y-4">
                    <div>
                        <p class="text-sm text-text-tertiary mb-1">Manufacturer</p>
                        <p class="text-lg font-medium text-text-primary">{{ medicine.manufacturer }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-text-tertiary mb-1">Batch Number</p>
                        <p class="text-lg font-medium text-text-primary">{{ medicine.batch_number or 'N/A' }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-text-tertiary mb-1">Category</p>
                        <p class="text-lg font-medium text-text-primary">{{ medicine.category }}</p>
                    </div>
                </div>
            </div>

            <!-- Pricing & Expiry -->
            <div class="card">
                <h3 class="text-xl font-heading font-semibold text-text-primary mb-6">Pricing & Expiry</h3>
                <div class="space-y-4">
                    <div>
                        <p class="text-sm text-text-tertiary mb-1">Unit Price</p>
                        <p class="text-3xl font-heading font-bold text-text-primary">₹{{ "%.2f"|format(medicine.price) }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-text-tertiary mb-1">Total Value</p>
                        <p class="text-lg font-medium text-text-primary">₹{{ "%.2f"|format(medicine.price * medicine.quantity) }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-text-tertiary mb-1">Expiry Date</p>
                        {% if medicine.expiry_date %}
                        <p class="text-lg font-medium {% if medicine.expiry_date < now.date() %}text-error{% elif (medicine.expiry_date - now.date()).days < 30 %}text-warning{% else %}text-text-primary{% endif %}">
                            {{ medicine.expiry_date.strftime('%d %b %Y') }}
                        </p>
                        {% else %}
                        <p class="text-lg font-medium text-text-tertiary">Not specified</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Description -->
        {% if medicine.description %}
        <div class="card">
            <h3 class="text-xl font-heading font-semibold text-text-primary mb-4">Description</h3>
            <p class="text-text-secondary">{{ medicine.description }}</p>
        </div>
        {% endif %}

        <!-- Recent Activity -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Recent Purchases -->
            <div class="card">
                <h3 class="text-xl font-heading font-semibold text-text-primary mb-6">Recent Purchases</h3>
                {% if recent_purchases %}
                <div class="space-y-3">
                    {% for purchase in recent_purchases %}
                    <div class="p-4 bg-background rounded-lg border border-border">
                        <div class="flex justify-between items-start mb-2">
                            <p class="font-medium text-text-primary">{{ purchase.quantity }} units</p>
                            <span class="badge {% if purchase.status == 'completed' %}badge-success{% elif purchase.status == 'pending' %}badge-warning{% else %}badge-error{% endif %}">
                                {{ purchase.status|title }}
                            </span>
                        </div>
                        <p class="text-sm text-text-tertiary">{{ purchase.order_date.strftime('%d %b %Y, %I:%M %p') }}</p>
                        <p class="text-sm text-text-secondary">₹{{ "%.2f"|format(purchase.total_amount) }}</p>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-text-tertiary text-center py-8">No purchase history</p>
                {% endif %}
            </div>

            <!-- Recent Sales -->
            <div class="card">
                <h3 class="text-xl font-heading font-semibold text-text-primary mb-6">Recent Sales</h3>
                {% if recent_sales %}
                <div class="space-y-3">
                    {% for sale in recent_sales %}
                    <div class="p-4 bg-background rounded-lg border border-border">
                        <div class="flex justify-between items-start mb-2">
                            <p class="font-medium text-text-primary">{{ sale.quantity }} units</p>
                            <p class="font-medium text-success">₹{{ "%.2f"|format(sale.total_amount) }}</p>
                        </div>
                        <p class="text-sm text-text-tertiary">{{ sale.sale_date.strftime('%d %b %Y, %I:%M %p') }}</p>
                        {% if sale.customer_name %}
                        <p class="text-sm text-text-secondary">Customer: {{ sale.customer_name }}</p>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-text-tertiary text-center py-8">No sales history</p>
                {% endif %}
            </div>
        </div>
    </main>

    {% include 'footer.html' %}
</body>
</html>